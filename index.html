<!DOCTYPE html>
<html>
<head>
    <title>JSSample</title>
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>

<body>
<!--
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Project name</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div>
    </div>
</nav>
-->

<div class="container">

    <h1>
        Wegmans API Hackin'
    </h1>
    City Name
    <br>
    <input type="text" id="zoneName" name="zoneName" value="">
    <br>
    <button id="submit" type="button" onclick="run()">Click Me!</button>

</div>


<script type="text/javascript">

    var authKey = "Bearer ";

      //GET KEYS
      $( document ).ready(function() {
        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "https://login.microsoftonline.com/1318d57f-757b-45b3-b1b0-9b3c3842774f/oauth2/token",
          "method": "POST",
          "headers": {
            "Content-Type": "application/x-www-form-urlencoded",
            "Cache-Control": "no-cache"
          },
          "data": {
            "client_id": "24960d97-4fbe-433d-ab8a-efeb89aa524e",
            "grant_type": "client_credentials",
            "resource": "https://wegmans-es.azure-api.net",
            "client_secret": "A8N7VeeCdFD5N4OxeQT1gFaXNStrxieEplYl3SYdxTs="
          }
        };

        $.ajax(settings).done(function (response) {
          authKey += response.access_token;
          console.log(authKey);
        });
      });

      //attach 'enter' key to button
      $("#zoneName").keyup(function(event) {
        if (event.keyCode === 13) {
          $("#submit").click();
        }
      });

    function run(){
      var subKey = "7a2da79699e74dd0af5b8158f6134fbd";

      var zoneName = document.getElementById("zoneName").value;
      console.log(zoneName);


      $.ajax({
        url: "https://wegmans-es.azure-api.net/locationpublic/location/stores?zoneName=" + zoneName,
        //url: "https://wegmans-es.azure-api.net/productpublic/productavailability/700632/stores",
        beforeSend: function(xhrObj){
          // Request headers
          xhrObj.setRequestHeader("Location-Subscription-Key", subKey);
          xhrObj.setRequestHeader("Product-Subscription-Key",subKey);
          xhrObj.setRequestHeader("Authorization",authKey);
          xhrObj.setRequestHeader("Availability-Subscription-Key", subKey);

        },
        type: "GET",
        // Request body
        data: "{body}"
      })
        .done(function(data) {
          console.log("success" + data[0].StoreNumber);
          /*for(var name in data) {
              console.log(name);
          }*/
          for(i = 0; i < 50; i++) {
            console.log(data[i].StoreNumber + ", ");
          }
        })
        .fail(function() {
          console.log("error");
        });
    }
</script>

</body>
</html>
